<!DOCTYPE html>
<html>
  <head>
    <title>Limeri Bingo</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Shantell+Sans:ital,wght@0,300..800;1,300..800&display=swap"
      rel="stylesheet"
    />
  </head>
  <body
    style="
      width: fit-content;
      text-align: center;
      padding: 2rem;
      margin: 0;
      font-family: 'Shantell Sans', cursive;
      background: #d9fc7d;
    "
  >
    <div style="display: flex" id="bingo-wrapper">
      <div>
        <div
          id="bingoDiv"
          style="
            width: fit-content;
            text-align: center;
            padding: 2rem;
            margin: 0;
            background: #fff;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            justify-content: center;
          "
        >
          <h1 style="color: #222; letter-spacing: 20px; font-size: 60px">Limeri Bingo</h1>
          <h2 style="margin-top: 2rem; color: #222; letter-spacing: 20px; font-size: 30px">
            BINGO BOARDS COMPLETED: <span id="bingoCounter"></span>
          </h2>

          <!-- <h1 style="color: white; letter-spacing: 20px; font-size: 60px">(24h stream edition)</h1> -->

          <table class="grid">
            <tbody>
              <!-- <tr>
                <td class="cell"></td>
                <td class="cell"></td>
                <td class="cell"></td>
                <td class="cell"></td>
                <td class="cell"></td>
                <td class="cell"></td>
                <td class="cell"></td>
              </tr> -->
              <tr>
                <!-- <td class="cell"></td>
                <td class="cell"></td> -->
                <td class="cell"></td>
                <td class="cell"></td>
                <td class="cell"></td>
                <td class="cell"></td>
                <td class="cell"></td>
              </tr>
              <tr>
                <!-- <td class="cell"></td>
                <td class="cell"></td> -->
                <td class="cell"></td>
                <td class="cell"></td>
                <td class="cell"></td>
                <td class="cell"></td>
                <td class="cell"></td>
              </tr>
              <tr>
                <!-- <td class="cell"></td> -->
                <td class="cell"></td>
                <td class="cell"></td>
                <td class="cell cell-free"></td>
                <td class="cell"></td>
                <td class="cell"></td>
                <!-- <td class="cell"></td> -->
              </tr>
              <tr>
                <!-- <td class="cell"></td>
                <td class="cell"></td> -->
                <td class="cell"></td>
                <td class="cell"></td>
                <td class="cell"></td>
                <td class="cell"></td>
                <td class="cell"></td>
              </tr>
              <tr>
                <!-- <td class="cell"></td>
                <td class="cell"></td> -->
                <td class="cell"></td>
                <td class="cell"></td>
                <td class="cell"></td>
                <td class="cell"></td>
                <td class="cell"></td>
              </tr>
              <!-- <tr>
                <td class="cell"></td>
                <td class="cell"></td>
                <td class="cell"></td>
                <td class="cell"></td>
                <td class="cell"></td>
                <td class="cell"></td>
                <td class="cell"></td>
              </tr> -->
            </tbody>
          </table>
        </div>
      </div>
      <div style="margin-left: 5rem; padding-top: 4rem; font-size: 24px">
        <ul style="list-style: none; padding: 0px" class="list">
          <li>WATCH LIME LIVE ON <a href="https://www.twitch.tv/limerien" target="_blank">TWITCH</a></li>
        </ul>
        <div
                style="
              margin-top: 10rem;
              display: flex;
              justify-content: center;
              flex-direction: column;
              align-items: center;
            "
        >
          <div class="btn" onclick="generateNewBoard()">
            <a>Generate new board</a>
          </div>
          <div class="btn" style="margin-top: 1.5rem" onclick="saveDivAsImage()">
            <a>Save board as Image</a>
          </div>
          <div class="btn" style="margin-top: 10rem" onclick="resetCounter()">
            <a>Reset counter</a>
          </div>
        </div>
      </div>
    </div>
    <style></style>
    <style>
      .cell {
        border: 2px solid #d7f20b;
        width: 150px;
        height: 150px;
        color: #000;
        padding: 10px;
        font-size: 20px;
        cursor: pointer;
        position: relative;
        min-width: 150px;
      }
      .circle {
        width: 130px;
        height: 130px;
        /* border: 12px solid yellow;
        border-radius: 50%; */
        z-index: 999;
        position: absolute;
        /* top: 0; */
      }
      .wrapper {
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
      }
      .btn {
        border: 1px solid black;
        padding: 24px;
        border-radius: 4px;
        font-size: 24px;
        cursor: pointer;
        width: fit-content;
      }
      .dark-mode {
        background: #c2f921 !important;
        .btn {
          color: #222;
          border: 1px solid #222;
        }
        li,
        a {
          color: #222;
        }
      }
      .highlight {
        border-width: 2px;
        border-color: red;
      }
      @media (max-width: 768px) {
        .cell {
          width: 100px;
          height: 100px;
          font-size: 16px;
          padding: 8px;
        }
        .circle {
          width: 90px;
          height: 90px;
          border-width: 8px;
        }
        .btn {
          padding: 16px;
          font-size: 20px;
        }
      }
      @keyframes rotate {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }
      @keyframes fade-in {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      @keyframes fade-out {
        from {
          opacity: 1;
        }
        to {
          opacity: 0;
        }
      }
    </style>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script>
      function generateNewBoard() {
        window.location.reload();
      }
      function saveDivAsImage() {
        const div = document.querySelector("#bingoDiv");
        html2canvas(div).then(function (canvas) {
          const link = document.createElement("a");
          link.href = canvas.toDataURL();
          link.download = "bingo.png";
          link.click();
        });
      }

      // ADD YOU COLLECTION OF PROMPTS HERE
      const collection = [
              "Lime says that she is a clown",
              "Lime denies lewd stuff",
              "Lime says \"FUCK\" 15 minutes of starting stream",
              "Stream dies (notLikeThis)",
              "Lime says MOMMY\\WIFE",
              "Someone in chat posts the \"P\" clip",
              "Limeri gets bullied by chat",
              "Lime will lie to herself and say she got bitches",
              "Sub goal reached",
              "Munch ASMR when she starts stream",
              "Lime fails to read",
              "Lime starts to crying",
              "Chat gaslighting Lime",
              "Strimmer is Latege",
              "Lime admits she is cute",
              "Lime shaking off emotes",
              "Desk took damage",
              "MAYHEM (Lime kills everything she sees)",
              "Lime brain fart, zones out on random stuff",
              "\"Gramri\" word mentioned by streamer",
              "Good girl denial",
              "Daddy hurricane knocks at the door",
              "ANNOYED AS FUCK",
              "Thirst upon anime character",
              "Stream got scuffed at beginning",
      ];

      const cells = document.querySelectorAll(".cell");
      const randomValues = getRandomValues(collection, 25);
      cells.forEach((cell, index) => {
        const div = document.createElement("div"); // Create a new div element
        div.classList.add("wrapper"); // Add the class "wrapper" to the div
        const paragraph = document.createElement("p"); // Create a new paragraph element
        if (cell.classList.contains("cell-free")) {
          div.innerHTML = "FREE SPACE";
        } else {
          paragraph.textContent = randomValues[index];
        }
        div.appendChild(paragraph); // Append the paragraph to the div
        cell.appendChild(div); // Append the div to the cell
      });

      function resetCounter() {
        localStorage.setItem("counter", "0");
        localStorage.setItem("isUpdated", "false");
        document.getElementById("bingoCounter").textContent = localStorage.getItem("counter");
      }

      function getRandomValues(array, count) {
        const shuffled = array.sort(() => 0.5 - Math.random());
        return shuffled.slice(0, count);
      }
      function toggleLineThrough() {
        if (this.querySelector(".circle")) {
          this.querySelector(".wrapper").removeChild(this.querySelector(".circle"));
        } else {
          const circle = document.createElement("img");
          circle.classList.add("circle");
          circle.src = "https://gitoido.github.io/limeri-bingo/lime.png";
          circle.style.width = "100px";
          circle.style.height = "100px";
          // circle.innerHTML =
          //   "<img style='widrth: 100%; height: 100%' alt='Gary.png' src='https://i.imgur.com/Eiffb3B.png' />";

          this.querySelector(".wrapper").appendChild(circle);
        }
      }

      document.addEventListener("DOMContentLoaded", function () {
        const darkMode = localStorage.getItem("dark-mode");
        if (darkMode === "true") {
          toggleDarkMode();
        }
        const counter = localStorage.getItem("counter");
        if (!counter) {
          localStorage.setItem("counter", "0");
        }
        const isUpdated = localStorage.getItem("isUpdated");
        localStorage.setItem("isUpdated", "false");
        document.getElementById("bingoCounter").textContent = localStorage.getItem("counter");
      });
      function logStringInConsole(string) {
        console.log(string);
      }
      function toggleDarkMode() {
        document.body.classList.toggle("dark-mode");
        if (document.body.classList.contains("dark-mode")) {
          localStorage.setItem("dark-mode", "true");
        } else {
          localStorage.setItem("dark-mode", "false");
        }
      }
      function checkForWinningCondition() {
        const rows = 5; // assuming 5x5 grid
        const cols = 5;
        let cellsArray = Array.from(cells);

        // Check rows and columns
        for (let i = 0; i < rows; i++) {
          let row = cellsArray.slice(i * rows, i * rows + rows);
          let col = cellsArray.filter((_, j) => j % cols === i);
          checkSequence(row);
          checkSequence(col);
        }

        // Check diagonals
        let diag1 = cellsArray.filter((_, i) => i % (rows + 1) === 0);
        let diag2 = cellsArray.filter((_, i) => i % (rows - 1) === 0 && i !== 0 && i !== cellsArray.length - 1);
        checkSequence(diag1);
        checkSequence(diag2);
      }

      function checkSequence(sequence) {
        let count = 0;
        let winningCells = [];
        for (let cell of sequence) {
          if (cell.querySelector(".circle")) {
            count++;
            winningCells.push(cell);
          } else {
            count = 0;
            winningCells = [];
          }
          if (count === 5) {
            winningCells.forEach((cell) => cell.classList.add("highlight"));
            const counter = localStorage.getItem("counter");
            const isUpdated = localStorage.getItem("isUpdated");
            if (isUpdated === "false") {
              localStorage.setItem("counter", parseInt(counter) + 1);
              document.getElementById("bingoCounter").textContent = localStorage.getItem("counter");
            }
            localStorage.setItem("isUpdated", "true");

            break;
          }
        }
      }

      function removeHighlight(cell) {
        const rows = 5; // assuming 5x5 grid
        const cols = 5;
        let cellsArray = Array.from(cells);
        let index = cellsArray.indexOf(cell);

        // Find the row, column, and diagonals that the cell belongs to
        let row = cellsArray.slice(Math.floor(index / rows) * rows, Math.floor(index / rows) * rows + rows);
        let col = cellsArray.filter((_, j) => j % cols === index % cols);
        let diag1 = cellsArray.filter((_, i) => i % (rows + 1) === index % (rows + 1));
        let diag2 = cellsArray.filter(
          (_, i) => i % (rows - 1) === index % (rows - 1) && i !== 0 && i !== cellsArray.length - 1
        );

        // Remove the "highlight" class from all cells in these groups
        [...row, ...col, ...diag1, ...diag2].forEach((cell) => cell.classList.remove("highlight"));
      }

      // Add this function call in the click event listener
      cells.forEach((cell) => {
        cell.addEventListener("click", function () {
          if (this.querySelector(".circle")) {
            removeHighlight(this);
          } else {
            checkForWinningCondition();
          }
          toggleLineThrough.call(this);
          checkForWinningCondition();
        });
      });
    </script>
  </body>
</html>
